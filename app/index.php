<?php 
	if (!isset($_REQUEST)) { 
	  return; 
	} 

	//–°—Ç—Ä–æ–∫–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Callback API 
	$confirmation_token = '1264f359'; 

	//–ö–ª—é—á –¥–æ—Å—Ç—É–ø–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ 
	$token = '01bebbcafbfc3ed8cc517331f2e36566909e52ed6cae9e048c511cd235c3840d50a22c83004a9107baa3b'; 
	$secret="ssl1237895";
	//–ü–æ–ª—É—á–∞–µ–º –∏ –¥–µ–∫–æ–¥–∏—Ä—É–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ 
	$data = json_decode(file_get_contents('php://input')); 
	include ('config.php');
	include('inser.php');
	include('functions.php');
	
	
	if($data->secret==$secret){//–µ—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ –≤ –≥—Ä—É–ø–ø–µ —Ä–∞–≤–µ–Ω –∫–æ–¥—É –∑–¥–µ—Å—å
		switch ($data->type) {
		  //–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∞–¥—Ä–µ—Å–∞... 
		  case 'confirmation': 
		    //...–æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è 
		    echo $confirmation_token; 
		    break; 

		  case 'group_join':
	        //...–ø–æ–ª—É—á–∞–µ–º id –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
	        //...–ø–æ–ª—É—á–∞–µ–º id –µ–≥–æ –∞–≤—Ç–æ—Ä–∞ 
		    $userId = $data->object->user_id; 
		    //–∑–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é users.get –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–µ 
		    $userInfo = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$userId}&fields=bdate,sex&v=5.8"));
			//–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –æ—Ç–≤–µ—Ç–∞ –µ–≥–æ –∏–º—è 
		    $user_name =$userInfo->response[0]->first_name; 

			$request_params = array(
		        'message' => "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–∞, ".$user_name."!<br>"."–ï—Å–ª–∏ —É –í–∞—Å –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –≤–æ–ø—Ä–æ—Å—ã, —Ç–æ –≤—ã –≤—Å–µ–≥–¥–∞ –º–æ–∂–µ—Ç–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º —Å–æ–æ–±—â–µ—Å—Ç–≤–∞.<br>"."–£—Å–ø–µ—Ö–æ–≤ –≤ –ø–æ–∏—Å–∫–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤!<br><br>–î–ª—è –Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ '–ü—Ä–∏–≤–µ—Ç'",
		        'user_id' => $userId,
		        'access_token' => $token,
		        'v' => '5.46'
		    );
		    $get_params = http_build_query($request_params); 

			file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
			//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API 

			echo('ok');
	        break;

		  //–ï—Å–ª–∏ —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏... 
		  case 'message_new'://–µ—Å–ª–∏ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
		    //...–ø–æ–ª—É—á–∞–µ–º id –µ–≥–æ –∞–≤—Ç–æ—Ä–∞ 
		  	$userId = $data->object->user_id;
		  	
		    //–∑–∞—Ç–µ–º —Å –ø–æ–º–æ—â—å—é users.get –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ–± –∞–≤—Ç–æ—Ä–µ 
		  	$userInfo = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$userId}&fields=bdate,sex,city&v=5.8"));
			//–∏ –∏–∑–≤–ª–µ–∫–∞–µ–º –∏–∑ –æ—Ç–≤–µ—Ç–∞ –µ–≥–æ –∏–º—è, –ø–æ–ª, –≥–æ—Ä–æ–¥
		    $user_name =$userInfo->response[0]->first_name; 
		    $r=0;//–¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å, —á—Ç–æ –æ—Ç–≤–µ—Ç —É–∂–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –∏ –Ω–µ –Ω—É–∂–Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
			
			$message = mb_strtolower("{$data->object->body}", 'UTF-8');
			$messages_array =array(
				'–ø—Ä–∏–≤–µ—Ç' => "–ü—Ä–∏–≤–µ—Ç, "."{$userInfo->response[0]->first_name}"."! –Ø –º–æ–≥—É –ø–æ–º–æ—á—å –Ω–∞–π—Ç–∏ —Ç–µ–±–µ –∫–æ–º–ø–∞–Ω–∏—é –Ω–∞ –≤–µ—á–µ—Ä, —Ö–æ—á–µ—à—å?",
				'–∑–∞–ø–æ–ª–Ω–∏—Ç—å'=>'–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –ª—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤'
			);
			foreach($messages_array as $k => $v){//–ø—Ä–æ—Å–º–æ—Ç—Ä –µ—Å—Ç—å –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –º–∞—Å—Å–∏–≤–µ
				if($message == $k){
					$otwet = $v;
					$r=1;
				}
			}

			if ($message=='2') {
				update($userId,0,'zapoln_ank');//–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É
				$otwet='–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –ª—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤';
				$r=1;
			}

			if (($message=='–ø–æ–º–æ—â—å')||($message=='–¥–∞')||($message=='—Ö–æ—á—É')) {
				$user=Get_data_all($userId);//–ø–æ–ª—Ü—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				$r=1;
				if ($user->user_zapoln_ank != 0) {
						$otwet="–í—ã–±–µ—Ä–∏ —á—Ç–æ –≤—ã —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å:<br>1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ—é –∞–Ω–∫—Ç–µ—É.<br>2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –º–æ—é –∞–Ω–∫–µ—Ç—É –∑–∞–Ω–æ–≤–æ.<br>3. –ü–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞.<br>4. –ù–µ —Ö–æ—á—É –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–æ –∏—Å–∫–∞—Ç—å";
				}
				else{
					if ($message=='–ø–æ–º–æ—â—å') {
						$otwet="–ù–∞–ø–∏—à–∏ '–ø—Ä–∏–≤–µ—Ç'";
					}
					else{
						$otwet='–î–ª—è –Ω–∞—á–Ω–∞–ª–∞ –∑–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É. –î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–ø–∏—à–∏ "–∑–∞–ø–æ–ª–Ω–∏—Ç—å"';
					}
				}
			}

			
			if ($message=='4') {
					$r=1;
					delete($userId);
					$otwet="–•–æ—Ä–æ—à–æ. –Ø —É–¥–∞–ª–∏–ª —Ç–≤–æ—é –∞–Ω–∫—Ç–µ—É";
			}

			if ($message=="1") {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∫–µ—Ç—É
				$user=Get_data_all($userId);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					$r=1;
					$otwet="–í–æ—Ç —Ç–≤–æ—è –∞–Ω–∫–µ—Ç–∞:<br><br>";
					up_yeras_old($userId,$user->user_date_born);//–æ–±–Ω–æ–≤–ª–Ω–µ–∏–µ –ø–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–Ω—ã—Ö –ª–µ—Ç
					$anketa=Get_data_all($userId);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º –∫–æ–ª–∏—á—Å—Ç–≤–æ–º –ª–µ—Ç
					$user_sex = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$userId}&fields=photo_max_orig&v=5.8"));//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º photo_max_orig
					$otwet=$otwet.'–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è:   '.$anketa->name_user.".";
					$otwet=$otwet.'<br>–ü–æ–ª–Ω—ã—Ö –ª–µ—Ç:   '.$anketa->user_years_old.".";
					$otwet="<br>–ü—Ä–æ–∂–∏–≤–∞–µ—Ç –≤ –≥–æ—Ä–æ–¥–µ:  ".$anketa->user_city.".";
					$otwet=$otwet."<br>–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤:  ".$anketa->user_like_kino.".";
					$otwet=$otwet."<br>–ò–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è:  ".$anketa->user_yvlech.".";
					if ($anketa->user_need_sex == "–º") {
						$ssex="–º—É–∂—á–∏–Ω–æ–π, –∫–æ—Ç–æ—Ä–æ–º—É";	
					}
					else{
						if ($anketa[$i]=="–∂") {
							$ssex="–¥–µ–≤—É—à–∫–æ–π, –∫–æ—Ç–æ—Ä–æ–π";
						}
					}
					$otwet=$otwet."<br>–•–æ—á—É –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å ".$ssex." –æ—Ç  ".$anketa->user_need_vizrast_ot;
					$otwet=$otwet." –¥–æ ".$anketa->user_need_vizrast_do."."; 
					$otwet=$otwet.'<br>–í–æ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è: '.$user_sex->response[0]->photo_max_orig;
				}
			}

			if ($message=='3') {//–ø–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞
				$user=Get_data_all($userId);//–ø–æ–ª—Ü—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank  != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					$r=1;
					update($userId,0,'id_posled_see');// id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ=0
					//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞—Ä—Ç–Ω—ë—Ä–µ
					$sex=Get_data_sex($user->sex_hochy,$user->user_need_vizrast_ot,$user->user_need_vizrast_do,$user->id_sex_zapros,$user->id_black_list_for_user);

					if ($sex==0) {//–µ—Å–ª–∏ –Ω–µ—Ç –∫–æ–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞ –∑–Ω–∞–∫–æ—Å—Ç–≤–æ
						$sex=Get_data_sex($user->sex_hochy,$user->user_need_vizrast_ot,$user->user_need_vizrast_do,0,$user->id_black_list_for_user);
					}

					if ($sex!=0) {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
						$otwet="–í–æ—Ç –∞–Ω–∫–µ—Ç–∞ —Ç–æ–≥–æ, —Å –∫–µ–º —Ç—ã –º–æ–∂–µ—à—å –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è:<br><br>";
						update($userId,$sex->id_partner,'id_sex'); //–í–ü–ò–°–ê–¢–¨ –í –ë–ê–ó–£ ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤—ã–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
						$user_sex = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$sex->id_vk_str}&fields=photo_max_orig&v=5.8"));//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º photo_max_orig

						$otwet=$otwet.'–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è:   '.$sex->name_partner.".";
						$otwet=$otwet.'<br>–ü–æ–ª–Ω—ã—Ö –ª–µ—Ç:   '.$sex->partner_years_old.".";
						$otwet="<br>–ü—Ä–æ–∂–∏–≤–∞–µ—Ç –≤ –≥–æ—Ä–æ–¥–µ:  ".$sex->partner_city.".";
						$otwet=$otwet."<br>–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤:  ".$sex->partner_kino.".";
						$otwet=$otwet."<br>–ò–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è:  ".$sex->partner_yvlech.".";
						if ($sex->partner_need_sex == "–º") {
							$ssex="–º—É–∂—á–∏–Ω–æ–π, –∫–æ—Ç–æ—Ä–æ–º—É";	
						}
						else{
							if ($sex->partner_need_sex == "–∂") {
								$ssex="–¥–µ–≤—É—à–∫–æ–π, –∫–æ—Ç–æ—Ä–æ–π";
							}
						}
						$otwet=$otwet."<br>–•–æ—á–µ—Ç –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å ".$ssex." –æ—Ç  ".$sex->partner_vozrast_ot;
						$otwet=$otwet." –¥–æ ".$sex->partner_vozrast_do."."; 
						$otwet=$otwet.'<br>–í–æ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è: '.$user_sex->response[0]->photo_max_orig.'<br><br> –•–æ—á–µ—à—å –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è? (11)–¥–∞ (3) –∏—Å–∫–∞—Ç—å –¥–∞–ª—å—à–µ';
					}
					else{
						$otwet="–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –Ω–µ—Ç –Ω–∏–∫–æ–≥–æ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å–≤–∏–∏ —Å —Ç–≤–æ–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏, –∑–∞—Ö–æ–¥–∏ –ø–æ–ø–æ–∑–∂–µ üòâ";
					}
				}
				else{
					$otwet="–£ —Ç–µ–±—è –µ—â—ë –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞ –∞–Ω–∫–µ—Ç–∞. –ó–∞–ø–æ–ª–Ω–∏ –µ—ë, —Ç–æ–≥–¥–∞ –≤—Å—ë –ø–æ–ª—É—á–∏—Ç—Å—è!";
				}
			}

			if ($message=="11") {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è
				$user=Get_data_all($userId);//–ø–æ–ª—Ü—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					$r=1;
					$sex=Get_data_id($user->id_sex_zapros);//–ø–æ–ª—É—á–µ–Ω–∏–µ ID –∫–æ–Ω–¥–∏–¥–∞—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞
					if ($sex!=0) {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
						$otwet="–ü—Ä–∏–≤–µ—Ç! –° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è "."{$userInfo->response[0]->first_name}".'.<br>–í–æ—Ç –∞–Ω–∫–µ—Ç–∞:<br><br>';
						
						//–∑–∞–ø–æ–º–∏–Ω–∞–µ–º id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏–ª –∑–∞–ø—Ä–æ—Å –Ω–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ, —á—Ç–æ–±—ã –¥—Ä—É–≥–∏–µ –Ω–µ –º–æ–≥–ª–∏ –ø–æ–¥–∞—Ç—å –∑–∞–ø—Ä–æ—Å
						update($sex,$userId,'id_posled_see');
						//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
						up_yeras_old($userId,$user->user_date_born);
						$request_params = array( 
					      'message' => "–°–µ–π—á–∞—Å —è —Å–ø—Ä–æ—à—É —Ö–æ—á–µ—Ç –ª–∏ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–æ–±–æ–π –ø–æ–æ–±—â–∞—Ç—å—Å—è, –ø–æ–¥–æ–∂–¥–∏ –Ω–µ–º–Ω–æ–≥–æ...", 
					      'user_id' => $userId,
					      'access_token' => $token,
					      'read_state' => 1,
					      'v' => '5.46'
					    );

						$get_params = http_build_query($request_params); 

						file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
						$user_sex = json_decode(file_get_contents("https://api.vk.com/method/users.get?user_ids={$userId}&fields=photo_max_orig&v=5.8"));//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º photo_max_orig
						$anketa=$user;
						$userId=$sex;
						$otwet=$otwet.'–ò–º—è –∏ —Ñ–∞–º–∏–ª–∏—è:   '.$anketa->name_user.".";
						$otwet=$otwet.'<br>–ü–æ–ª–Ω—ã—Ö –ª–µ—Ç:   '.$anketa->user_years_old.".";
						$otwet="<br>–ü—Ä–æ–∂–∏–≤–∞–µ—Ç –≤ –≥–æ—Ä–æ–¥–µ:  ".$anketa->user_city.".";
						$otwet=$otwet."<br>–õ—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤:  ".$anketa->user_like_kino.".";
						$otwet=$otwet."<br>–ò–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è:  ".$anketa->user_yvlech.".";
						if ($anketa->user_need_sex == "–º") {
							$ssex="–º—É–∂—á–∏–Ω–æ–π, –∫–æ—Ç–æ—Ä–æ–º—É";	
						}
						else{
							if ($anketa[$i]=="–∂") {
								$ssex="–¥–µ–≤—É—à–∫–æ–π, –∫–æ—Ç–æ—Ä–æ–π";
							}
						}
						$otwet=$otwet."<br>–•–æ—á—É –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è —Å ".$ssex." –æ—Ç  ".$anketa->user_need_vizrast_ot;
						$otwet=$otwet." –¥–æ ".$anketa->user_need_vizrast_do."."; 
						$otwet=$otwet.'<br>–í–æ—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è: '.$user_sex->response[0]->photo_max_orig.'<br><br> –•–æ—á–µ—à—å –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è? (!1)–¥–∞ (!0) –Ω–µ—Ç. –ò–ª–∏ –∑–∞–±–ª–æ–∫–∏—Ä—É–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–ø–∏—Å–∞–≤ "!—á—Å"?';
					}
				}
			}

			if ($message=="!1") {//–µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è
				$user=Get_data_all($userId);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					$r=1;
					$sex=$user->id_posled_see_user;//–ø–æ–ª—É—á–µ–Ω–∏–µ ID –∫–æ–Ω–¥–∏–¥–∞—Ç–∞ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞
					if ($sex!=0) {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω
						//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
						$otwet="–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —Å —Ç–æ–±–æ–π –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è: http://vk.com/id".$userId;
						$request_params = array( 
					      'message' => "$otwet", 
					      'user_id' => $sex,
					      'access_token' => $token,
					      'read_state' => 1,
					      'v' => '5.46'
					    );

						$get_params = http_build_query($request_params); 

						file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
						$otwet="–≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —Å —Ç–æ–±–æ–π –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è: http://vk.com/id".$sex;
						update($userId,0,'id_posled_see');
					}
					else{$otwet=$user->id_posled_see_user." ".$sex;}
				}
			}

			if ($message=="!0") {//–µ—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ö–æ—á–µ—Ç –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è
				$user=Get_data_all($userId);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
					$request_params = array( 
				      'message' => "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ö–æ—á–µ—Ç —Å —Ç–æ–±–æ–π –æ–±—â–∞—Ç—å—Å—è, –ø–æ–ø—Ä–æ–±—É–π –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏—Ö –∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ '3'.", 
				      'user_id' => $user->id_posled_see_user,
				      'access_token' => $token,
				      'read_state' => 1,
				      'v' => '5.46'
				    );

					$get_params = http_build_query($request_params); 

					file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);
					update($userId,0,'id_posled_see');//–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ id_posled_see –Ω–∞ 0
					$otwet="–•–æ—Ä–æ—à–æ, –Ω–∞–ø–∏—à–∏ '3' –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤";
					$r=1;//–∑–∞–ø–æ–º–∏–Ω–∞–µ–º –æ—Ç–≤–µ—Ç
				}
			}

			if ($message=="!—á—Å") {//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–≥–æ
				$user=Get_data_all($userId);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
				if ($user->user_zapoln_ank != 0) {//–µ—Å–ª–∏ –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
					$black_list=Get_data_all($user->id_posled_see_user);//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
					update($user->id_posled_see_user,$black_list->id_black_list_for_user.".".$black_list->id_sex_zapros,'id_black_list');//–¥–æ–±–∞–≤–ª—è–µ–º id –≤ —á—ë—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫

					//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 
					$request_params = array( 
				      'message' => "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —Ö–æ—á–µ—Ç —Å —Ç–æ–±–æ–π –æ–±—â–∞—Ç—å—Å—è, –ø–æ–ø—Ä–æ–±—É–π –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –¥—Ä—É–≥–∏—Ö –∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ '3'.", 
				      'user_id' => $user->id_posled_see_user,
				      'access_token' => $token,
				      'read_state' => 1,
				      'v' => '5.46'
				    );

					$get_params = http_build_query($request_params); 

					file_get_contents('https://api.vk.com/method/messages.send?'. $get_params);

					update($userId,0,'id_posled_see');//–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ id_posled_see –Ω–∞ 0
					$otwet="–•–æ—Ä–æ—à–æ, —è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–ø–µ—Ä—å –æ–Ω –±–æ–ª—å—à–µ –Ω–µ –±—É–¥–µ—Ç —Ç–µ–±–µ –ø–∏—Å–∞—Ç—å";
					$r=1;//–∑–∞–ø–æ–º–∏–Ω–∞–µ–º –æ—Ç–≤–µ—Ç
				}
			}
			
			/*–ü–†–ï–î–£–ü–†–ï–ñ–î–ê–Æ, —á—Ç–æ –±—ã–ª –∏—Å–ø—Ä–æ–±–æ–≤–∞–Ω –º–µ—Ç–æ–¥ switch, –Ω–æ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã—à–ª–æ, –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞—Ç–∞–π —Ä–æ–∂–¥–µ–Ω–∏—è, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç, –∏–Ω–∞—á–µ –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å switch, –Ω–æ —Ç–æ–≥–¥–∞ –∫–æ–¥–∞ –±—É–¥–µ—Ç –±–æ–ª—å—à–µ, —Ç–∞–∫ –∫–∞–∫ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ —Ä–∞–∑–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö, –µ—Å–ª–∏ –±—ã–ª –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.
			*/

			if(($message=="–ó–∞–ø–æ–ª–Ω–∏—Ç—å")||($message=="–∑–∞–ø–æ–ª–Ω–∏—Ç—å")){//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –∑–∞–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∫–µ—Ç—É
				$first_name_plus_name="{$userInfo->response[0]->first_name}"." "."{$userInfo->response[0]->last_name}";//–ø–æ–ª–Ω–æ–µ –∏–º—è
				$data_user=Get_data_all($userId,'id_str');

				//–µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –∞–Ω–∫–µ—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞
				if (($data_user == 0)||((isset($data_user->user_zapoln_ank))&&($data_user->user_zapoln_ank == 0))) {
					insert($userId,"id_str");//–¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
					update($userId,$first_name_plus_name,"name");//–¥–æ–±–∞–≤–∏—Ç—å –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é –≤ –±–∞–∑—É
					if ($userInfo->response[0]->sex==2) {//—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
						update($userId,"–∂","sex_hochy");
					}
					else{
						update($userId,"–º","sex_hochy");
					}
				}
				else{
					$otwet="–£ —Ç–µ–±—è —É–∂–µ –µ—Å—Ç—å –∞–Ω–∫–µ—Ç–∞. –ù–∞–ø–∏—à–∏ '2' –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∞–Ω–∫–µ—Ç—ã –∑–∞–Ω–æ–≤–æ".$m[9];
				}
			}
			else{
				if($r==0) {//–µ—Å–ª–∏ –æ—Ç–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–µ–Ω —É–∂–µ –Ω–∞–π–¥–µ–Ω –∏ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
					$request_params = array( 
				      'offset' => "1", 
				      'count' => "1",
				      'peer_id' => $userId,
				      'access_token' => $token,
				      'v' => '5.67'
				    );

					$get_params = http_build_query($request_params); 
					
					$pre_message=json_decode(file_get_contents('https://api.vk.com/method/messages.getHistory?'.$get_params));//–ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –≤—ã–±–æ—Ä –ø—Ä–µ–¥–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ
					if($pre_message->response->items[0]->body=="–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –ª—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤"){//–µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –ª—é–±–∏–º—ã–µ –∂–∞–Ω—Ä—ã —Ñ–∏–ª—å–º–æ–≤."
						update("$userId","$message","kino");
						if ((isset($userInfo->response[0]->bdate))&&(strlen($userInfo->response[0]->bdate)>=8)) {//–µ—Å–ª–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ –≤–∫–æ–Ω—Ç–∞–∫—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è
							update("$userId","{$userInfo->response[0]->bdate}","date_born");
							up_yeras_old($userId,"{$userInfo->response[0]->bdate}");
							if (isset($userInfo->response[0]->city->title)) {
								update($userId,$userInfo->response[0]->city->title,'city');//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –±–∞–∑—É
								$otwet="–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è, —á–µ–º —Ç—ã –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?";
							}
							else{
								$otwet="–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ç—ã –∂–∏–≤–µ—à—å";
							}
							update($userId,0,'zapoln_ank');//–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É
						}
						else{
							$otwet="–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥)   *–ø–∏—à–∏ —Ä–µ–∞–ª—å–Ω—É—é –¥–∞—Ç—É, —Ç–∞–∫ –∫–∞–∫ –æ—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ, —Å –∫–µ–º —Ç—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏—à—å—Å—è";
							update($userId,0,'zapoln_ank');//–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É
						}
					}
					else{
						if (($pre_message->response->items[0]->body=="–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥)   *–ø–∏—à–∏ —Ä–µ–∞–ª—å–Ω—É—é –¥–∞—Ç—É, —Ç–∞–∫ –∫–∞–∫ –æ—Ç —ç—Ç–æ–≥–æ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ, —Å –∫–µ–º —Ç—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏—à—å—Å—è")||($d->response->items[0]->body=="–¢–∞–∫–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥) –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è")) {
							if (!preg_match_all("/[0-9.]+/",$message)) {//–µ—Å–ª–∏ –ø–æ–ª–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–ø–∏—Å–∞–ª —Ç–æ–ª—å–∫–æ —Ü–∏—Ñ—Ä—ã –∏ —Ç–æ—á–∫–∏
								$otwet="–¢–∞–∫–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥) –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è";
							}
							else{
								$let=explode(".", $message);
								if (((int)$let[0]<=31)&&((int)$let[0]>0)) {//–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –¥–Ω–µ–π –≤ –º–µ—Å—è—Ü–µ –æ—Ç 1 –¥–æ 31
									if (((int)$let[1]<=12)&&((int)$let[1]>0)) {//–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –º–µ—Å—è—Ü–µ–≤ –æ—Ç 1 –¥–æ 12
										if (((int)$let[2]<=(date("Y")-12))&&((int)$let[2]>=1947)){//–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≥–æ–¥—É –æ—Ç 1950 –¥–æ 12 –ª–µ—Ç
											up_yeras_old($userId,$message);//–ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª–Ω—ã—Ö –ª–µ—Ç
											if (isset($userInfo->response[0]->city->title)) {//–µ—Å–ª–∏ –≤ –ø—Ä–æ—Ñ–∏–ª–µ —É–∫–∞–∑–∞–Ω –≥–æ—Ä–æ–¥
												update($userId,$userInfo->response[0]->city,'city');//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –±–∞–∑—É
												$otwet="–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è, —á–µ–º —Ç—ã –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?";
											}
											else{
												$otwet="–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ç—ã –∂–∏–≤–µ—à—å";
											}
										}
										else {$otwet="–¢–∞–∫–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥) –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è";}
									}
									else {$otwet="–¢–∞–∫–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥) –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è";}
								}
								else {$otwet="–¢–∞–∫–æ–π –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å (–æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì(–¥–µ–Ω—å.–º–µ—Å—è—Ü.–≥–æ–¥) –Ω–∞–ø–∏—à–∏ –¥–∞—Ç—É —Å–≤–æ–µ–≥–æ —Ä–æ–∂–¥–µ–Ω–∏—è";}
							}
						}	
						else{
							if($pre_message->response->items[0]->body=="–ù–∞–ø–∏—à–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ç—ã –∂–∏–≤–µ—à—å"){
								update($userId,$message,'city');//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ –≤ –±–∞–∑—É
								$otwet="–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è, —á–µ–º —Ç—ã –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?";
							}
							else{
								if($pre_message->response->items[0]->body=="–ù–∞–ø–∏—à–∏ —Å–≤–æ–∏ –∏–Ω—Ç–µ—Ä–µ—Å—ã, —Ö–æ–±–±–∏, —É–≤–ª–µ—á–µ–Ω–∏—è, —á–µ–º —Ç—ã –ª—é–±–∏—à—å –∑–∞–Ω–∏–º–∞—Ç—å—Å—è?"){
									update("$userId","$message","yvlech");//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —É–≤–ª–µ—á–µ–Ω–∏–π –≤ –±–∞–∑—É
									$otwet="–û—Ç –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?";
								}
								else{
									if (($pre_message->response->items[0]->body=="–û—Ç –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?")||($pre_message->response->items[0]->body=="–¢–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ. –í–≤–µ–¥–∏ –¥—Ä—É–≥–æ–µ.")) {
										if (!preg_match_all("/[0-9]+/",$message)||((int)$message<13)||((int)$message>79)) {//–≤–æ–∑—Ä–∞—Å—Ç –æ—Ç 13 –¥–æ 80 –∏ –≤–≤–µ—Å—Ç–∏ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞
											$otwet="–¢–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ. –í–≤–µ–¥–∏ –¥—Ä—É–≥–æ–µ.";
										}
										else{
												update("$userId","$message","vozrast_ot");//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞–π—Ç–∏ –ø–∞—Ä—É –≤ –±–∞–∑—É
												$otwet="–î–æ –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?";
										}
									}
									else{
										if (($pre_message->response->items[0]->body=="–î–æ –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ —Ç—ã —Ö–æ—á–µ—à—å –Ω–∞–π—Ç–∏ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞?")||($pre_message->response->items[0]->body=="–¢–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ. –í–≤–µ–¥–∏ –¥—Ä—É–≥–æ–π –≤–æ–∑—Ä–∞—Å—Ç.")) {
											if (!preg_match_all("/[0-9]+/",$message)||((int)$message<14)||((int)$message>80)) {//–≤–æ–∑—Ä–∞—Å—Ç –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä –æ—Ç 14 –¥–æ 81 –∏ –≤–≤–µ—Å—Ç–∏ –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–∞
												$otwet="–¢–∞–∫–æ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–æ–æ–±—â–µ—Å—Ç–≤–µ. –í–≤–µ–¥–∏ –¥—Ä—É–≥–æ–π –≤–æ–∑—Ä–∞—Å—Ç.";
											}
											else{
												update("$userId","$message","vozrast_do");//–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ –∫–∞–∫–æ–≥–æ –≤–æ–∑—Ä–æ—Å—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –Ω–∞–π—Ç–∏ –ø–∞—Ä—É –≤ –±–∞–∑—É
												$otwet="–ü–æ–∑–¥—Ä–∞–≤–ª—è—é, —Ç–µ–ø–µ—Ä—å –∞–Ω–∫–µ—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∞!<br><br>–¢–µ–ø–µ—Ä—å –≤—ã–±–µ—Ä–∏—Ç–µ —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å:<br>1. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ—é –∞–Ω–∫—Ç–µ—É.<br>2. –ó–∞–ø–æ–ª–Ω–∏—Ç—å –º–æ—é –∞–Ω–∫–µ—Ç—É –∑–∞–Ω–æ–≤–æ.<br>3.  –ü–æ–∏—Å–∫ –Ω–æ–≤–æ–≥–æ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫–∞.<br>4. –ù–µ —Ö–æ—á—É –±–æ–ª—å—à–µ –Ω–∏–∫–æ–≥–æ –∏—Å–∫–∞—Ç—å";
												update($userId,1,'zapoln_ank');//–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø–æ–ª–Ω–∏–ª –∞–Ω–∫–µ—Ç—É
											}
										}
										else{
											$otwet="–¢—ã –Ω–∞–ø–∏—Å–∞–ª –Ω–µ–∏–∑–≤–µ—Å–Ω—É—é –∫–æ–º–∞–Ω–¥—É. –ù–∞–ø–∏—à–∏—Ç–µ '–ü–æ–º–æ—â—å' –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏.";//–µ—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–æ—Å—å –æ—Ç–≤–µ—Ç–∞
										}
									}
								}
							}
						}
					}
				}
			}
			//–° –ø–æ–º–æ—â—å—é messages.send –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ 

		    $request_params = array( 
		      'message' => "$otwet", 
		      'user_id' => $userId,
		      'random_id'=>mt_rand(20, 99999999),
		      'access_token' => $token,
		      'v' => '5.46'
		    );

			$get_params = http_build_query($request_params); 

			file_get_contents('https://api.vk.com/method/messages.send?'. $get_params); 
			//–í–æ–∑–≤—Ä–∞—â–∞–µ–º "ok" —Å–µ—Ä–≤–µ—Ä—É Callback API 

			echo('ok');
		    return false;
		    break;
		}
	   }
?>